{% extends 'base.html' %}

{% load static %}

{% block titulo %}
   Venda de Produtos
{% endblock %}

{% block corpo %}

    <br>
    <div id="form">

    </div>
    <br>
    <div id="tabela">

    </div>
    <br/>
    <br/>
    <br/>

{% endblock %}

{% block domready %}

    $.get("{% url 'produto:cadastra_produto' %}", function(resposta) {
        $("#form").html(resposta)
    })

    $.get("{% url 'produto:lista_produto' %}", function(resposta) {
        $("#tabela").html(resposta)
    })

    $("#form").on("click", ".adicionar", function() {
        let form = $(this).parent().parent().parent().parent().parent()
        let url = form.attr("action")
        let formData = form.serializeArray()
        $.post(url, formData, function(resposta) {
            $("#body").prepend(`<tr>
                         <td class="text-left align-middle categoria">
                         </td>
                         <td class="text-center align-middle nome">
                         </td>
                        <td class="text-right pr-5 align-middle preco">
                         </td>
                         <td class="text-center align-middle quantidade">
                            <form class="mx-auto" style="width: 60px;"
                                  action ="{% url 'produto:atualiza_produto' %}"
                                  method ="POST" novalidate>
                            </form>
                         </td>
                         <td class="text-right pr-5 align-middle preco_total">
                         </td>
                         <td class="text-center align-middle">
                            <form action ="{% url 'produto:atualiza_produto' %}"
                                  method ="post" novalidate>
                               <button style="margin-top: 0px; margin-bottom: 0px;
                                              padding-top: 3px; padding-bottom: 3px;
                                              width: 40px"
                                       type="button"
                                       class="btn btn-sm btn-danger remover"
                                       tabindex="-1">
                                  <img src="{% static 'images/skin/remove.png' %}">
                               </button>
                            </form>
                         </td>
                      </tr>`)
            $("tr:first-child").find(".categoria").text(resposta.categoria)
            $("tr:first-child").find(".nome").text(resposta.nome)
            $("tr:first-child").find(".preco").text(resposta.preco)
            $("tr:first-child").find(".quantidade").text(resposta.quantidade)
            $("tr:first-child").find(".preco_total").text(resposta.preco_total)
        })
    })

{% endblock %}